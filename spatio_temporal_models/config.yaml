# Gene Expression Simulation Configuration
# =========================================
# This file contains all parameters for the 3D stochastic gene expression simulation.

# Kinetic Rates
# -------------
# All rates are in units of 1/second

kinetics:
  k_on: 0.5              # Transcription site activation rate
  k_off: 0.4             # Transcription site deactivation rate
  k_r: 0.3               # RNA initiation rate (when TS is ON)
  k_p: 0.01               # Protein translation initiation rate (per cytoplasmic RNA)

  transport_rate: 10.0    # Nuclear export rate (for RNA near envelope)

  gamma_p: 0.01          # Protein degradation rate 
  gamma_r: 0.001          # RNA degradation rate


  # Diffusion coefficients
  k_diff_r: 0.5         # RNA diffusion coefficient (in px^2/s)
  k_diff_p: 0.5         # Protein diffusion coefficient (in px^2/s)

# Elongation Times (NEW)
# ----------------------
# Time required for synthesis to complete (deterministic)

elongation:
  RNA_elongation_time: 3.0       # Seconds to synthesize one RNA (polymerase elongation)
  Protein_elongation_time: 3.0   # Seconds to synthesize one protein (ribosome elongation)

# Cell Geometry (in pixels)
# -------------------------
# All sizes are [X, Y, Z] dimensions
# For half-ellipsoid shapes, these represent the full ellipsoid diameters
# (actual dome height is half the Z value)

geometry:
  simulation_volume_size: [512, 512, 100]   # Microscopy field of view
  cytosol_size: [350, 350, 80]              # Cell diameter/height
  nucleus_size: [30, 30, 10]              # Nucleus diameter/height
  nucleus_xy_offset: [0, 0]                 # Nucleus offset from center [X, Y]

# Simulation Settings
# -------------------
# total_time is the RECORDED time (what you see in plots)
# burnin_time is added BEFORE recording (for reaching steady state)
# Actual simulation runs for: total_time + burnin_time

simulation:
  total_time: 1800        # Recorded time (seconds) - this is what appears in plots
  frame_rate: 5           # Save state every N seconds
  burnin_time: 2000       # Equilibration time before recording (not shown in output)
  random_seed: 42         # Random seed for reproducibility (remove or set to null for random)
  
  # Simplified model (tau-leap, for fast testing)
  use_simplified_model: true   # Set true to use simplified_simulation.py instead
  simplified_dt: 0.1            # Time step for simplified model (seconds)

# Transcription Site Options
# --------------------------

transcription_site:
  position: center       # Options: 'center' or 'random'

# Protein Movement
# ----------------

movement:
  protein_into_nucleus: false   # Allow proteins to enter nucleus

# Drug Perturbation (optional)
# ----------------------------

drug:
  apply: false
  application_time: 120         # Time to apply drug (seconds)
  inhibited_parameters:
    transport_rate: 0.1         # New transport rate after drug

# Output Options
# ---------------

output:
  generate_gif: false           # Generate animated GIF of temporal evolution
  gif_fps: 4                    # Frames per second for GIF animation
  gif_skip_frames: 2            # Only render every Nth frame (1=all, 5=every 5th)
  gif_dpi: 80                   # DPI for GIF frames (lower = smaller file)
  gif_show_surfaces: true       # Show cell surfaces (SLOW - disable for faster generation)
  gif_surface_decimation: 4     # Downsample surfaces by this factor (1=full, 4=4x faster)
  show_nascent_separately: true # Show nascent molecules with different colors

# =============================================================================
# Microscopy Image Simulation
# =============================================================================
# Parameters for generating synthetic fluorescence microscopy images

microscopy:
  # Image Dimensions
  image_size_yx: [512, 512]     # [Y, X] pixels (rows, cols)
  num_z_slices: 10              # Number of Z slices in stack
  
  # Physical Parameters (for metadata)
  voxel_size_yx_nm: 130.0       # Pixel size in XY (nanometers)
  voxel_size_z_nm: 300.0        # Z-step size (nanometers)
  # NOTE: time_interval uses simulation/frame_rate (NOT defined here to avoid duplication)
  
  # PSF (Point Spread Function) Parameters
  psf:
    sigma_xy: 1.2               # Lateral PSF width (pixels)
    sigma_z: 2.0                # Axial PSF width (z-slice units)
  
  # Signal-to-Noise Ratios (spot intensity = SNR × local_background)
  # This provides realistic spot brightness relative to cell autofluorescence
  snr:
    # RNA spots: peak = snr × cytosol_intensity
    # SNR of 2.5 with cytosol=400 gives peak intensity ~1000
    mature_rna: 2.5
    
    # TS: ACCUMULATIVE - intensity = (min + per_rna × N) × nucleus_intensity
    # Example: 5 nascent RNAs with nucleus=500 gives (1.5 + 0.5×5) × 500 = 2000
    ts_min: 1.5              # Minimum SNR when TS active
    ts_per_nascent_rna: 0.5  # Additional SNR per nascent RNA
    
    # Nascent proteins: ACCUMULATIVE per ribosome
    # Multiple nascent chains on same RNA are additive
    nascent_protein_per_chain: 1.5
    
    # Mature proteins: diffuse signal (no discrete spots)
    mature_protein_per_molecule: 0.002
  
  # Spot Size Parameters (not intensity-related)
  spot_size:
    # TS size scales with nascent count
    ts_sigma_base: 2.0          # Base PSF sigma for TS (pixels)
    ts_sigma_per_rna: 0.3       # Additional sigma per nascent RNA
    ts_size_function: 'sqrt'    # 'sqrt' or 'log' for size scaling
    
    # Mature protein diffuse blur
    mature_protein_blur_sigma: 15.0  # Blur sigma to simulate diffusion
  
  # Baseline Intensities (realistic camera/autofluorescence values)
  # These determine the absolute intensity scale of the image
  # Typical confocal: background 200-500, max ~3000-10000
  baseline:
    outside_cell: 1000        # Background outside cell
    cytosol: 1600             # Cytoplasmic autofluorescence
    nucleus: 1800             # Nuclear autofluorescence (slightly higher)
  
  # Noise Parameters
  noise:
    read_noise_std: 5.0         # Gaussian read noise (camera)
    shot_noise_enabled: true    # Enable Poisson shot noise
    shot_noise_scale: 0.1       # Shot noise scaling factor
    cellular_noise_amplitude: 10.0  # Spatially correlated texture
    cellular_noise_sigma: 8.0   # Spatial correlation length (pixels)
  
  # Channel Names (for TIFF metadata)
  channel_names:
    - "TS"
    - "Mature_RNA"
    - "Nascent_Protein"
    - "Mature_Protein"
  
  # Photobleaching (exponential decay)
  # Decay rate k in s⁻¹: I(t) = I(t) * exp(-k * t)
  # k=0.0 means no photobleaching (default)
  # Typical range: 0.0001 to 0.01 s⁻¹ (rSNAPed uses 0.001 s⁻¹)
  photobleaching:
    channel_0_decay_rate: 0.00016    # TS: ~25% loss
    channel_1_decay_rate: 0.00012    # Mature RNA: ~20% loss
    channel_2_decay_rate: 0.00016    # Nascent Protein: ~25% loss
    channel_3_decay_rate: 0.00020    # Mature Protein: ~30% loss
  
  # Random seed (null for random, or integer for reproducibility)
  random_seed: 42

